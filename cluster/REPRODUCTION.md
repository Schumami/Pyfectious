

# Reproducing Experiments  
  
This file provides instructions on launching experiments in the **cluster** folder, whether on a local system or on another computational cluster.  
  
## [experiment_example_town.py](https://github.com/amehrjou/Pyfectious/blob/develop/cluster/experiment_example_town.py "[experiment_example_town.py](http://experiment_example_town.py/)")  
  
  
Using this file, one should be able to reproduce the experiments related to configurations in [main_experimental_towns](https://github.com/amehrjou/Pyfectious/tree/develop/data/json/main_experimental_towns "main_experimental_towns"), by changing the  
  
```experiment_folder = ''```  
  
to the name of the target configuration folder, i.e., **main_experimental_towns**, or any other arbitrary folder designed in the same way and as explained on Pyfectious tutorials.  A folder like this should typically have different towns, indexed like town_i, and each listing three configuration files. 
  
Moreover, the script accepts a **process_id** through the command line. This is developed based on our cluster's specifications to run multiple experiments in parallel. In order to produce the results **sequentially**, one must change the following lines of code:  
```  
# Get the process on the cluster  
process = int(str(sys.argv[1]))  
```  
to:  
```  
# Get the process on the cluster  
  
process = FIXED_PROCESS_ID  
```  
  
where FIXED_PROCESS_ID represents a unique id related to the experimental towns in [main_experimental_towns](https://github.com/amehrjou/Pyfectious/tree/develop/data/json/main_experimental_towns "main_experimental_towns"). The parameters below determine what this number should actually be.  
```  
number_of_individual_runs = 16 # Number of random seeds  
number_of_town_folders = 1 # Total number of setups  
```  
  
Since there is currently just one setting, the second value does not matter at this point. However, the first one represents the number of individual runs for each sample town in the main_experimental_town folder. We recommend setting this to 1 when you have limited computational power. Then, the town_id that is going to be used as the configuration is found by **dividing process_id to number_of_individual_runs**.  
  
  
For example, setting FIXED_PROCESS_ID = 10, when number_of_individual_runs = 1, results in the simulation of [town_10](https://github.com/amehrjou/Pyfectious/tree/develop/data/json/main_experimental_towns/town_10 "town_10") in [main_experimental_towns](https://github.com/amehrjou/Pyfectious/tree/develop/data/json/main_experimental_towns "main_experimental_towns").  

### Plotting the results
To plot the results, please follow the steps in [Generate_Plots.ipynb](https://github.com/amehrjou/Pyfectious/blob/develop/cluster/Generate_Plots.ipynb "Generate_Plots.ipynb"). The utility functions defined in [cluster_utils.py](https://github.com/amehrjou/Pyfectious/blob/develop/cluster/cluster_utils.py "cluster_utils.py") are employed in the notebook to parse the results generated by the experiments. Most importantly, the **build_experiment_results_data_dict** function parses the entire CSV files of all the experiments into a huge dictionary and uses this final dictionary to plot the simulation curves. 
```
def build_experiment_results_data_dict(number_of_experiments: int = 16,
	experiment_name_constant_part: str = 'data_town_',
	folder_name: str = 'data',
	experiment_folder: str or None = 'cluster_experiment_1',
	add_time: bool = False) -> Dict[int, List[Dict]]:
```
Make sure to set the correct path for the **experiment_folder** parameter, e.g., *main_experimental_towns*. The **data_town_i** folders- generated by the main script- should be placed in this directory and under a new folder called **data** for the function to work with default parameters. If you stored the resulting data somewhere else, make sure to set the **folder_name** parameter properly. Please see the documentation of utility functions ( [cluster_utils.py](https://github.com/amehrjou/Pyfectious/blob/develop/cluster/cluster_utils.py "cluster_utils.py")) for more information.  
## [experiment_optimization.py](https://github.com/amehrjou/Pyfectious/blob/develop/cluster/experiment_optimization.py "[experiment_optimization.py](http://experiment_optimization.py/)")  
  
  
The script here is focused on the optimization example provided in the main paper. Using a hyper-parameter optimization library, one can run a series of experiments using this script to find optimal behavior.

Make sure to set the following two parameters if running on a local machine. 

```
process = 0 # int(str(sys.argv[1])) 
number_of_individual_runs = 1
``` 
More individual runs can produce different random seeds and are used in our experiments to build error bands and stronger empirical results.

### Plotting the results
To plot the results of optimization experiments, please refer to 
